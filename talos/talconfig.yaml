---
clusterName: homelab
endpoint: "https://${CONTROL_PLANE_VIP}:6443"
talosVersion: v1.9.3
kubernetesVersion: v1.31.5

nodes:
  # Test nodes on Vagrant
  - hostname: worker
    ipAddress: worker.local
    installDisk: /dev/vda
    controlPlane: false
  - hostname: controller
    ipAddress: controller.local
    installDisk: /dev/vda
    controlPlane: true

  # Real nodes for prod
  - hostname: hermes
    ipAddress: 192.168.10.3
    installDisk: /dev/nvme0n1
    controlPlane: false
    machineDisks:
      - device: /dev/sda
        partitions:
          - mountpoint: /var/mnt/longhorn

  - hostname: zeus
    ipAddress: 192.168.10.4
    installDisk: /dev/nvme0n1
    controlPlane: true
    machineDisks:
      - device: /dev/sda
        partitions:
          - mountpoint: /var/mnt/longhorn

allowSchedulingOnControlPlanes: true

cniConfig:
  name: none

patches:
  - "@./patches/machine/longhorn.yaml"
  - "@./patches/machine/features.yaml"
  - "@./patches/cluster/coredns.yaml"
  - "@./patches/cluster/admission_control.yaml"
  - "@./patches/cluster/env.yaml"

controlPlane:
  patches:
    - "@./patches/machine/vip.yaml"
    - "@./patches/cluster/kube-proxy.yaml"

  schematic:
    customization:
      extraKernelArgs:
        - talos.platform=metal
      systemExtensions:
        officialExtensions:
          - siderolabs/iscsi-tools
          - siderolabs/util-linux-tools
          - siderolabs/intel-ucode

worker:
  schematic:
    customization:
      extraKernelArgs:
        - talos.platform=metal
      systemExtensions:
        officialExtensions:
          - siderolabs/iscsi-tools
          - siderolabs/util-linux-tools
          - siderolabs/intel-ucode
